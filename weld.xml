<?xml version="1.0" encoding="iso-8859-1"?>

<project name="Weld source integration" default="build" basedir=".">

    <!-- import build.xml for init target and inherited properties -->
    <import file="build.xml"/>
    <import file="build-taskdefs.xml"/>

    <target name="build" depends="init">
        <antcall target="javassist.build" />

        <antcall target="googlecollections.build" />

        <antcall target="jboss-interceptor-api.build" />

        <antcall target="jboss-interceptor.build" />

        <antcall target="javax-inject.build" />

        <ant antfile="slf4j.xml" target="build" />

        <antcall target="weld.build" />
    </target>

    <!-- javassist -->

    <target name="javassist.checkout" >
        <echo message="checkout javassist from ${javassist.svn.url}."/>
        <exec executable="svn" dir="${external.dir}" failonerror="true" >
            <arg line="checkout" />
            <arg line="${javassist.svn.url}" />
            <arg line="javassist" />
        </exec>
    </target>
    <target name="javassist.build" depends="javassist.checkout" >
        <!-- build javassist -->
        <exec executable="mvn" dir="${external.dir}/javassist" failonerror="true" >
            <arg line="-Dmaven.repo.local=${maven.repo.local}" />
            <arg line="install" />
        </exec>
    </target>

    <!-- google collections -->

    <target name="googlecollections.checkout" >
        <echo message="checkout google collections from ${googlecollections.svn.url}."/>
        <exec executable="svn" dir="${external.dir}" failonerror="true" >
            <arg line="checkout" />
            <arg line="${googlecollections.svn.url}" />
            <arg line="google-collections" />
        </exec>
    </target>
    <target name="googlecollections.build" depends="googlecollections.checkout" >
        <!-- build google collections-->
        <exec executable="mvn" dir="${external.dir}/google-collections" failonerror="true" >
            <arg line="-Dmaven.repo.local=${maven.repo.local}" />
            <arg line="install" />
        </exec>
    </target>

    <!-- jboss interceptor api -->

    <target name="jboss-interceptor-api.checkout" >
        <echo message="checkout jboss-interceptor-api from ${jboss-interceptor-api.svn.url}."/>
        <exec executable="svn" dir="${external.dir}" failonerror="true" >
            <arg line="checkout" />
            <arg line="${jboss-interceptor-api.svn.url}" />
            <arg line="jboss-interceptor-api" />
        </exec>
    </target>
    <target name="jboss-interceptor-api.build" depends="jboss-interceptor-api.checkout" >
        <!-- build jboss-interceptor-api -->
        <exec executable="mvn" dir="${external.dir}/jboss-interceptor-api" failonerror="true" >
            <arg line="-Dmaven.repo.local=${maven.repo.local}" />
            <arg line="install" />
        </exec>
    </target>

    <!-- jboss interceptor -->

    <target name="jboss-interceptor.checkout" >
        <echo message="checkout jboss-interceptor from ${jboss-interceptor.svn.url}."/>
        <exec executable="svn" dir="${external.dir}" failonerror="true" >
            <arg line="checkout" />
            <arg line="${jboss-interceptor.svn.url}" />
            <arg line="jboss-interceptor-parent" />
        </exec>
    </target>
    <target name="jboss-interceptor.build" depends="jboss-interceptor.checkout" >
        <!-- build jboss-interceptor -->
        <exec executable="mvn" dir="${external.dir}/jboss-interceptor-parent" failonerror="true" >
            <arg line="-Dmaven.repo.local=${maven.repo.local}" />
            <arg line="install" />
        </exec>
    </target>

    <!-- javax inject -->
    <!-- NOTE: This build executes a build.sh script because the maven environment -->
    <!--       was not suitable for maven 2 source build -->

    <target name="javax-inject.checkout" >
        <echo message="checkout javax-inject from ${javax-inject.svn.url}."/>
        <exec executable="svn" dir="${external.dir}" failonerror="true" >
            <arg line="checkout" />
            <arg line="${javax-inject.svn.url}" />
            <arg line="javax-inject" />
        </exec>
    </target>
    <target name="javax-inject.build" depends="javax-inject.checkout" >
        <!-- build javax-inject -->
        <exec executable="./build.sh" dir="${external.dir}/javax-inject/" failonerror="true" />
        <mvn.publish.local jar="${external.dir}/javax-inject/build/dist/javax.inject.jar"
            mvngroup="javax.inject" mvnartid="javax.inject"
            mvnversion="${javax-inject.version}"/>
    </target>

    <!-- weld build -->

    <target name="weld.build" depends="weld-api.build, weld-core.build" />

    <!-- weld api -->

    <target name="weld-api.build" depends="weld-api.checkout" >
        <!-- build weld-api -->
        <exec executable="mvn" dir="${external.dir}/weld-api" failonerror="true" >
	    <arg line="-Dmaven.repo.local=${maven.repo.local}" />
            <arg line="install" />
	</exec>
    </target>
    <target name="weld-api.checkout" >
        <echo message="checkout weld-api from ${weld-api.svn.url}."/>
        <exec executable="svn" dir="${external.dir}" failonerror="true" >
            <arg line="checkout" />
            <arg line="${weld-api.svn.url}" />
            <arg line="weld-api" />
        </exec>
    </target>

    <!-- weld core -->

    <target name="weld-core.build" depends="weld-core.checkout" >
        <!-- build weld-core -->
        <exec executable="mvn" dir="${external.dir}/weld-core" failonerror="true" >
            <arg line="-Dmaven.repo.local=${maven.repo.local} -P skip-tests" />
            <arg line="install" />
        </exec>
    </target>
    <target name="weld-core.checkout" >
        <echo message="checkout weld-core from ${weld-core.svn.url}."/>
        <exec executable="svn" dir="${external.dir}" failonerror="true" >
            <arg line="checkout" />
            <arg line="${weld-core.svn.url}" />
            <arg line="weld-core" />
        </exec>
    </target>

</project>
